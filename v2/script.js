// --- TRANSLATIONS JSON ---
const translations = {
    en: {
        nav: {
            services: "Services",
            about: "About Us",
            contact: "Contact",
            blog: "Blog",
            getStarted: "Get Started"
        },
        hero: {
            titlePart1: "Future-Proof Your Business with",
            titlePart2: "AI & Data Intelligence",
            subtitle: "I help businesses leverage artificial intelligence and data-driven strategies to optimize technology, unlock new opportunities, and drive intelligent growth.",
            cta1: "Book a Consultation",
            cta2: "Services"
        },
        services: {
            title: "My Core Services",
            subtitle: "I empower your business with cutting-edge, data-driven solutions designed for the future.",
            aiAutomation: {
                title: "AI Automatizations",
                description: "Streamline your operations and boost productivity by integrating custom AI agents to handle repetitive tasks and complex workflows."
            },
            dataVisualization: {
                title: "Data Visualization",
                description: "Transform complex datasets into clear, interactive dashboards. We help you uncover actionable insights and make informed decisions instantly."
            },
            softwareDevelopment: {
                title: "Software Development",
                description: "From web applications to enterprise systems, we build robust, scalable, and secure software solutions tailored to your specific business needs."
            },
            mvpValidation: {
                title: "MVP Validations",
                description: "Bring your ideas to life quickly and efficiently. We help you build and test Minimum Viable Products to validate concepts and secure market fit."
            },
            cloudSolutions: {
                title: "Cloud Solutions",
                description: "Leverage the power and scalability of the cloud. We provide expert services for migration, optimization, and management of your cloud infrastructure."
            },
            aiEducation: {
                title: "AI Educational Services",
                description: "Empower your team with our tailored training programs. We teach your staff how to effectively use AI tools to boost creativity and productivity."
            }
        },
        clients: {
            subtitle: "I have experience working with enterprise clients in banking, technology, and consulting sectors"
        },
        about: {
            title: "Your Trusted Partner in Innovation",
            description: "I see technology as your competitive advantage. As a data-driven professional, my mission is to harness the power of artificial intelligence and advanced analytics to solve complex challenges and unlock your full potential in a digital-first world. I am more than a consultant; I am your partner in innovation.",
            value1Title: "8+ Years",
            value1Desc: "Industry experience",
            value2Title: "20+ Projects",
            value2Desc: "Successfully delivered worldwide",
            value3Title: "24/7 Support",
            value3Desc: "Dedicated assistance when you need it",
            whyChooseTitle: "Why Work With Me?",
            feature1: "<strong>Data-Driven Approach:</strong> I tailor every solution to your unique challenges and goals.",
            feature2: "<strong>AI & Analytics Expertise:</strong> With 8+ years of experience working with industry-leading companies, I bring deep technical knowledge.",
            feature3: "<strong>Results-Driven:</strong> I focus on delivering measurable outcomes that improve your bottom line."
        },
        contact: {
            title: "Let's Build Your Future",
            subtitle: "Ready to discuss your next project? Fill out the form below or reach out to me directly.",
            successTitle: "Thank you! ",
            successMessage: "Your message has been sent successfully. I'll be in touch soon.",
            form: {
                namePlaceholder: "Your Name",
                emailPlaceholder: "Your Email",
                serviceDefault: "Select a Service",
                serviceOther: "Other",
                messagePlaceholder: "How can I help you?",
                submitButton: "Send Message"
            }
        },
        footer: {
            tagline: "Strategic IT Consulting & Software Development",
            quickLinksTitle: "Quick Links",
            contactTitle: "Contact Me",
            connectTitle: "Connect",
            email: "Email: cgarciarosales97@gmail.com",
            phone: "Phone: +34 603 418 717",
            location: "Málaga, Andalusia, Spain",
            linkedin: "LinkedIn",
            github: "GitHub",
            blog: "Blog",
            copyright: "&copy; 2024 Carlos García Rosales. All Rights Reserved."
        },
        modals: {
            "ai-automation": {
                title: "Automating Customer Support",
                description: "Imagine a custom AI chatbot on your website that handles 80% of customer inquiries 24/7, answers questions instantly, and escalates complex issues to your human team. This frees up your staff to focus on high-value tasks, reduces response times, and significantly improves customer satisfaction."
            },
            "data-visualization": {
                title: "Interactive Sales Dashboard",
                description: "We can build a real-time sales dashboard that transforms raw sales data from multiple sources into actionable insights. Track KPIs, identify top-performing regions and products, and forecast future trends with beautiful, easy-to-understand charts and graphs, empowering your sales team to make smarter decisions."
            },
            "software-development": {
                title: "Custom Inventory Management System",
                description: "Is off-the-shelf software not meeting your needs? We can develop a bespoke inventory management system that integrates perfectly with your existing supply chain, automates reordering, tracks stock levels across multiple warehouses in real-time, and reduces manual data entry errors, saving you time and money."
            },
            "mvp-validation": {
                title: "Testing a New App Idea",
                description: "Have a great app idea but not sure if it will succeed? We'll help you build a Minimum Viable Product (MVP) with core features in just a few weeks. You can then launch it to a small group of users to gather real-world feedback, validate market demand, and secure investor interest before committing to a full-scale development project."
            },
            "cloud-solutions": {
                title: "Migrating to a Scalable Infrastructure",
                description: "Is your on-premise server struggling to keep up with traffic? We can seamlessly migrate your entire infrastructure to a scalable cloud platform like AWS or Azure. This provides better performance, enhanced security, and a pay-as-you-go model that reduces hardware costs and allows you to scale effortlessly during peak demand."
            },
            "ai-education": {
                title: "Empowering Your Marketing Team",
                description: "We'll conduct a hands-on workshop for your marketing team, teaching them how to use generative AI tools for content creation, ad copy, and market research. Your team will learn to generate high-quality drafts in seconds, analyze competitor strategies more effectively, and launch campaigns faster, boosting creativity and ROI."
            }
        }
    },
    es: {
        nav: {
            services: "Servicios",
            about: "Nosotros",
            contact: "Contacto",
            blog: "Blog",
            getStarted: "Comenzar"
        },
        hero: {
            titlePart1: "Asegura el Futuro de tu Negocio con",
            titlePart2: "IA e Inteligencia de Datos",
            subtitle: "Ayudo a las empresas a aprovechar la inteligencia artificial y estrategias basadas en datos para optimizar la tecnología, desbloquear nuevas oportunidades e impulsar un crecimiento inteligente.",
            cta1: "Reservar Consulta",
            cta2: "Servicios"
        },
        services: {
            title: "Servicios Principales",
            subtitle: "Potencio tu negocio con soluciones vanguardistas basadas en datos y diseñadas para el futuro.",
            aiAutomation: {
                title: "Automatizaciones con IA",
                description: "Optimiza tus operaciones e incrementa la productividad integrando agentes de IA personalizados para manejar tareas repetitivas y flujos de trabajo complejos."
            },
            dataVisualization: {
                title: "Visualización de Datos",
                description: "Transforma conjuntos de datos complejos en paneles claros e interactivos. Te ayudamos a descubrir insights accionables y tomar decisiones informadas al instante."
            },
            softwareDevelopment: {
                title: "Desarrollo de Software",
                description: "Desde aplicaciones web hasta sistemas empresariales, construimos soluciones de software robustas, escalables y seguras adaptadas a las necesidades específicas de tu negocio."
            },
            mvpValidation: {
                title: "Validaciones de MVP",
                description: "Lleva tus ideas a la vida de manera rápida y eficiente. Te ayudamos a construir y probar Productos Mínimos Viables para validar conceptos y asegurar el ajuste al mercado."
            },
            cloudSolutions: {
                title: "Soluciones en la Nube",
                description: "Aprovecha el poder y la escalabilidad de la nube. Proporcionamos servicios expertos para migración, optimización y gestión de tu infraestructura en la nube."
            },
            aiEducation: {
                title: "Servicios Educativos de IA",
                description: "Potencia a tu equipo con nuestros programas de capacitación personalizados. Enseñamos a tu personal cómo usar eficazmente las herramientas de IA para impulsar la creatividad y productividad."
            }
        },
        clients: {
            subtitle: "Tengo experiencia trabajando con clientes empresariales en sectores de banca, tecnología y consultoría"
        },
        about: {
            title: "Tu Socio Confiable en Innovación",
            description: "Veo la tecnología como tu ventaja competitiva. Como profesional basado en datos, mi misión es aprovechar el poder de la inteligencia artificial y análisis avanzados para resolver desafíos complejos y desbloquear tu máximo potencial en un mundo digital. Soy más que un consultor; soy tu socio en innovación.",
            value1Title: "8+ Años",
            value1Desc: "Experiencia en la industria",
            value2Title: "20+ Proyectos",
            value2Desc: "Entregados exitosamente en todo el mundo",
            value3Title: "Soporte 24/7",
            value3Desc: "Asistencia dedicada cuando la necesites",
            whyChooseTitle: "¿Por Qué Trabajar Conmigo?",
            feature1: "<strong>Enfoque Basado en Datos:</strong> Adapto cada solución a tus desafíos y objetivos únicos.",
            feature2: "<strong>Experiencia en IA y Análisis:</strong> Con más de 8 años de experiencia trabajando con empresas líderes en la industria, aporto un profundo conocimiento técnico.",
            feature3: "<strong>Orientado a Resultados:</strong> Me enfoco en entregar resultados medibles que mejoren tu rentabilidad."
        },
        contact: {
            title: "Construyamos tu Futuro",
            subtitle: "¿Listo para discutir tu próximo proyecto? Completa el formulario a continuación o contáctame directamente.",
            successTitle: "¡Gracias! ",
            successMessage: "Tu mensaje ha sido enviado exitosamente. Me pondré en contacto pronto.",
            form: {
                namePlaceholder: "Tu Nombre",
                emailPlaceholder: "Tu Email",
                serviceDefault: "Selecciona un Servicio",
                serviceOther: "Otro",
                messagePlaceholder: "¿Cómo puedo ayudarte?",
                submitButton: "Enviar Mensaje"
            }
        },
        footer: {
            tagline: "Consultoría IT Estratégica y Desarrollo de Software",
            quickLinksTitle: "Enlaces Rápidos",
            contactTitle: "Contáctame",
            connectTitle: "Conecta",
            email: "Email: cgarciarosales97@gmail.com",
            phone: "Teléfono: +34 603 418 717",
            location: "Málaga, Andalucía, España",
            linkedin: "LinkedIn",
            github: "GitHub",
            blog: "Blog",
            copyright: "&copy; 2024 Carlos García Rosales. Todos los Derechos Reservados."
        },
        modals: {
            "ai-automation": {
                title: "Automatización de Soporte al Cliente",
                description: "Imagina un chatbot de IA personalizado en tu sitio web que maneja el 80% de las consultas de clientes las 24 horas, responde preguntas al instante y escala problemas complejos a tu equipo humano. Esto libera a tu personal para enfocarse en tareas de alto valor, reduce los tiempos de respuesta y mejora significativamente la satisfacción del cliente."
            },
            "data-visualization": {
                title: "Panel de Ventas Interactivo",
                description: "Podemos construir un panel de ventas en tiempo real que transforma datos de ventas sin procesar de múltiples fuentes en insights accionables. Rastrea KPIs, identifica regiones y productos de mejor rendimiento, y pronostica tendencias futuras con gráficos hermosos y fáciles de entender, empoderando a tu equipo de ventas para tomar decisiones más inteligentes."
            },
            "software-development": {
                title: "Sistema de Gestión de Inventario Personalizado",
                description: "¿El software comercial no satisface tus necesidades? Podemos desarrollar un sistema de gestión de inventario a medida que se integra perfectamente con tu cadena de suministro existente, automatiza los pedidos, rastrea niveles de stock en múltiples almacenes en tiempo real y reduce errores de entrada manual de datos, ahorrándote tiempo y dinero."
            },
            "mvp-validation": {
                title: "Probando una Nueva Idea de App",
                description: "¿Tienes una gran idea de app pero no estás seguro si tendrá éxito? Te ayudaremos a construir un Producto Mínimo Viable (MVP) con características principales en solo unas semanas. Luego puedes lanzarlo a un pequeño grupo de usuarios para recopilar comentarios del mundo real, validar la demanda del mercado y asegurar el interés de inversores antes de comprometerte con un proyecto de desarrollo a gran escala."
            },
            "cloud-solutions": {
                title: "Migración a una Infraestructura Escalable",
                description: "¿Tu servidor local está luchando para mantener el ritmo del tráfico? Podemos migrar sin problemas toda tu infraestructura a una plataforma en la nube escalable como AWS o Azure. Esto proporciona mejor rendimiento, seguridad mejorada y un modelo de pago por uso que reduce costos de hardware y te permite escalar sin esfuerzo durante la demanda pico."
            },
            "ai-education": {
                title: "Empoderando a tu Equipo de Marketing",
                description: "Realizaremos un taller práctico para tu equipo de marketing, enseñándoles cómo usar herramientas de IA generativa para creación de contenido, textos publicitarios e investigación de mercado. Tu equipo aprenderá a generar borradores de alta calidad en segundos, analizar estrategias de competidores más efectivamente y lanzar campañas más rápido, impulsando la creatividad y el ROI."
            }
        }
    }
};

// --- LANGUAGE FUNCTIONALITY ---
let currentLanguage = 'en';

function changeLanguage(lang) {
    currentLanguage = lang;
    document.getElementById('current-language').textContent = lang.toUpperCase();
    document.getElementById('language-dropdown-menu').classList.add('hidden');
    
    // Update all elements with data-translate attributes
    document.querySelectorAll('[data-translate]').forEach(element => {
        const key = element.getAttribute('data-translate');
        const text = getNestedTranslation(translations[lang], key);
        if (text) {
            element.innerHTML = text;
        }
    });
    
    // Update all elements with data-translate-placeholder attributes
    document.querySelectorAll('[data-translate-placeholder]').forEach(element => {
        const key = element.getAttribute('data-translate-placeholder');
        const text = getNestedTranslation(translations[lang], key);
        if (text) {
            element.placeholder = text;
        }
    });
    
    // Update select options with data-translate attributes
    document.querySelectorAll('option[data-translate]').forEach(option => {
        const key = option.getAttribute('data-translate');
        const text = getNestedTranslation(translations[lang], key);
        if (text) {
            option.textContent = text;
        }
    });
    
    // Update document language attribute
    document.documentElement.lang = lang;
}

function getNestedTranslation(obj, path) {
    return path.split('.').reduce((current, key) => current && current[key], obj);
}

// Language dropdown toggle
document.addEventListener('DOMContentLoaded', function() {
    const dropdownButton = document.getElementById('language-dropdown-button');
    const dropdownMenu = document.getElementById('language-dropdown-menu');
    
    dropdownButton.addEventListener('click', function(e) {
        e.stopPropagation();
        dropdownMenu.classList.toggle('hidden');
    });

    // Close dropdown when clicking outside
    document.addEventListener('click', function() {
        dropdownMenu.classList.add('hidden');
    });

    dropdownMenu.addEventListener('click', function(e) {
        e.stopPropagation();
    });
});

document.addEventListener("DOMContentLoaded", function () {
    // --- Three.js 3D Animation ---
    const canvasContainer =
        document.querySelector("#hero-canvas").parentElement;
    const canvas = document.getElementById("hero-canvas");

    if (canvas && typeof THREE !== "undefined") {
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(
            75,
            canvasContainer.offsetWidth /
                canvasContainer.offsetHeight,
            0.1,
            1000,
        );
        const renderer = new THREE.WebGLRenderer({
            canvas,
            alpha: true,
            antialias: true,
        });
        renderer.setSize(
            canvasContainer.offsetWidth,
            canvasContainer.offsetHeight,
        );
        renderer.setPixelRatio(
            Math.min(window.devicePixelRatio, 2),
        );

        camera.position.z = 10;

        const sphereRadius = 4;
        const geometry = new THREE.SphereGeometry(
            sphereRadius,
            64,
            64,
        );

        const originalPositions =
            geometry.attributes.position.clone();
        const normals = geometry.attributes.normal.clone();

        const material = new THREE.PointsMaterial({
            size: 0.06,
            vertexColors: true,
            sizeAttenuation: true,
            transparent: true,
            opacity: 0.8,
            blending: THREE.AdditiveBlending,
        });

        const colors = [];
        const color = new THREE.Color();
        const positions = geometry.attributes.position;

        for (let i = 0; i < positions.count; i++) {
            const y = positions.getY(i);
            const darkBlue = new THREE.Color(0x1e3a8a);
            const brightCyan = new THREE.Color(0x00ffff);
            const ratio = (y + sphereRadius) / (sphereRadius * 2);
            color.lerpColors(darkBlue, brightCyan, ratio);
            colors.push(color.r, color.g, color.b);
        }
        geometry.setAttribute(
            "color",
            new THREE.Float32BufferAttribute(colors, 3),
        );

        const sphere = new THREE.Points(geometry, material);
        scene.add(sphere);

        const clock = new THREE.Clock();
        const mouse = new THREE.Vector2(0, 0);

        function onMouseMove(event) {
            const rect = canvas.getBoundingClientRect();
            mouse.x =
                ((event.clientX - rect.left) / rect.width) * 2 - 1;
            mouse.y =
                -((event.clientY - rect.top) / rect.height) * 2 + 1;
        }
        window.addEventListener("mousemove", onMouseMove);

        function animate() {
            requestAnimationFrame(animate);
            const elapsedTime = clock.getElapsedTime();

            const positions = geometry.attributes.position;
            for (let i = 0; i < positions.count; i++) {
                const originalX = originalPositions.getX(i);
                const originalY = originalPositions.getY(i);
                const originalZ = originalPositions.getZ(i);
                const normal = new THREE.Vector3(
                    normals.getX(i),
                    normals.getY(i),
                    normals.getZ(i),
                );
                const wave1 =
                    0.5 * Math.sin(originalX * 1.5 + elapsedTime);
                const wave2 =
                    0.25 *
                    Math.sin(originalY * 2.5 + elapsedTime * 1.5);
                const wave3 =
                    0.25 *
                    Math.sin(originalZ * 2.0 + elapsedTime * 2.0);
                const displacement = wave1 + wave2 + wave3;
                const newPos = new THREE.Vector3(
                    originalX,
                    originalY,
                    originalZ,
                ).add(normal.multiplyScalar(displacement));
                positions.setXYZ(i, newPos.x, newPos.y, newPos.z);
            }
            positions.needsUpdate = true;

            sphere.rotation.y +=
                0.05 * (mouse.x * 0.5 - sphere.rotation.y);
            sphere.rotation.x +=
                0.05 * (-mouse.y * 0.5 - sphere.rotation.x);

            renderer.render(scene, camera);
        }

        function onWindowResize() {
            renderer.setSize(
                canvasContainer.offsetWidth,
                canvasContainer.offsetHeight,
            );
            camera.aspect =
                canvasContainer.offsetWidth /
                canvasContainer.offsetHeight;
            camera.updateProjectionMatrix();
        }
        window.addEventListener("resize", onWindowResize, false);

        animate();
    }

    // --- Mobile menu toggle ---
    const mobileMenuButton =
        document.getElementById("mobile-menu-button");
    const mobileMenu = document.getElementById("mobile-menu");
    mobileMenuButton.addEventListener("click", () =>
        mobileMenu.classList.toggle("hidden"),
    );
    document.querySelectorAll("#mobile-menu a").forEach((link) => {
        link.addEventListener("click", () =>
            mobileMenu.classList.add("hidden"),
        );
    });

    // --- Contact form submission ---
    const contactForm = document.getElementById("contact-form");
    const successMessage = document.getElementById(
        "form-success-message",
    );
    contactForm.addEventListener("submit", function (e) {
        e.preventDefault();
        
        // Get form data
        const name = document.getElementById("contact-name").value;
        const email = document.getElementById("contact-email").value;
        const serviceSelect = document.getElementById("contact-service");
        const serviceValue = serviceSelect.value;
        const serviceText = serviceSelect.options[serviceSelect.selectedIndex].text;
        const message = document.getElementById("contact-message").value;
        
        // Create WhatsApp message
        const whatsappMessage = `Hello! New contact form submission:

Name: ${name}
Email: ${email}
Service: ${serviceText}
Message: ${message}`;
        
        // Encode the message for URL
        const encodedMessage = encodeURIComponent(whatsappMessage);
        
        // WhatsApp number (include country code without + sign)
        const whatsappNumber = "34603418717";
        
        // Create WhatsApp URL
        const whatsappUrl = `https://wa.me/${whatsappNumber}?text=${encodedMessage}`;
        
        // Open WhatsApp
        window.open(whatsappUrl, '_blank');
        
        // Show success message and reset form
        successMessage.classList.remove("hidden");
        contactForm.reset();
        setTimeout(
            () => successMessage.classList.add("hidden"),
            5000,
        );
    });

    // --- Service Modal Logic ---
    const serviceModal = document.getElementById("service-modal");
    const modalTitle = document.getElementById("modal-title");
    const modalDescription =
        document.getElementById("modal-description");
    const modalOverlay = document.getElementById("modal-overlay");
    const modalCloseBtn = document.getElementById("modal-close");

    document.querySelectorAll(".service-card").forEach((card) => {
        card.addEventListener("click", () => {
            const serviceKey = card.dataset.service;
            const details = translations[currentLanguage].modals[serviceKey];

            if (details) {
                modalTitle.textContent = details.title;
                modalDescription.textContent = details.description;
                serviceModal.classList.remove("hidden");
                serviceModal.classList.add("flex");
                document.body.classList.add("overflow-hidden");

                // Trigger fade in animation
                setTimeout(() => {
                    modalOverlay.classList.remove("opacity-0");
                    document
                        .getElementById("modal-content")
                        .classList.remove("scale-95");
                }, 10);
            }
        });
    });

    function closeModal() {
        document.body.classList.remove("overflow-hidden");
        modalOverlay.classList.add("opacity-0");
        document
            .getElementById("modal-content")
            .classList.add("scale-95");

        setTimeout(() => {
            serviceModal.classList.add("hidden");
            serviceModal.classList.remove("flex");
        }, 300); // Wait for transition to finish
    }

    modalOverlay.addEventListener("click", closeModal);
    modalCloseBtn.addEventListener("click", closeModal);

    // --- General Scroll-triggered Animations ---
    const animatedElements =
        document.querySelectorAll("[data-animation]");
    if (
        animatedElements.length > 0 &&
        typeof anime !== "undefined"
    ) {
        const observer = new IntersectionObserver(
            (entries, observer) => {
                entries.forEach((entry) => {
                    if (entry.isIntersecting) {
                        const element = entry.target;
                        const animationType =
                            element.dataset.animation;

                        if (animationType === "fade-up") {
                            anime({
                                targets: element,
                                translateY: [15, 0],
                                opacity: [0, 1],
                                duration: 800,
                                easing: "easeOutCubic",
                            });
                        } else if (
                            animationType === "stagger-fade-up"
                        ) {
                            element.style.opacity = 1;
                            anime({
                                targets: Array.from(
                                    element.children,
                                ),
                                translateY: [15, 0],
                                opacity: [0, 1],
                                delay: anime.stagger(100),
                                duration: 600,
                                easing: "easeOutCubic",
                            });
                        } else if (
                            animationType === "slide-in-left"
                        ) {
                            anime({
                                targets: element,
                                translateX: [-40, 0],
                                opacity: [0, 1],
                                duration: 900,
                                easing: "easeOutCubic",
                            });
                        } else if (
                            animationType === "slide-in-right"
                        ) {
                            anime({
                                targets: element,
                                translateX: [40, 0],
                                opacity: [0, 1],
                                duration: 900,
                                easing: "easeOutCubic",
                            });
                        }
                        observer.unobserve(element);
                    }
                });
            },
            { threshold: 0.1 },
        );

        animatedElements.forEach((el) => observer.observe(el));
    }
});
