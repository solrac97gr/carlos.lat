---
title: "驴C贸mo hacer bulk insert en ElasticSearch en Go? "
date: "13 de Julio del 2022"
published: "2022-07-13"
abstract: "Crearemos una funci贸n que se encargar谩 de serializar la informaci贸n dentro del array y luego guardarla dentro de un buffer para luego enviarla ."
image: "https://firebasestorage.googleapis.com/v0/b/portfolio-18ce8.appspot.com/o/images%2F4482734.png?alt=media&token=3da62197-fa7a-45fd-84d8-0ed2d2983cfa"
tag: "golang, Go "
author: "Carlos Garc铆a"
---
# 驴C贸mo hacer bulk insert en ElasticSearch en Go? 

<small>13 de Julio del 2022</small><EditPost path="como-hacer-bulk-insert-elasticsearch-go" />

<img width="100%" alt="golang wallpaper" src="https://firebasestorage.googleapis.com/v0/b/portfolio-18ce8.appspot.com/o/images%2F4482734.png?alt=media&token=3da62197-fa7a-45fd-84d8-0ed2d2983cfa"/>

Usando ElasticSearch con Go encontr茅 un reto en espec铆fico que consist铆a en enviar una cantidad de informaci贸n a un Index en ES para ello no encontr茅 una documentaci贸n clara que resolviera mi duda de c贸mo funcionaba y en mi caso porqu茅 fallaba.

Navegando en Stackoverflow encontr茅 una soluci贸n con algunos errores y proced铆 a optimizarla y arreglarla.

Consist铆a en crear una funci贸n que se encargar谩 de serializar la informaci贸n dentro del array y luego guardar esta informaci贸n ya serializada dentro de un buffer para luego enviarla.

Aqu铆 les dejo la soluci贸n en c贸digo con algunos casos espec铆ficos debido al programa que estaba realizando, t煤 puedes cambiarlo y adaptarlo a tu caso de negocio.

```go
func ParseToNDJson(data []domain.ElasticLog, dst *bytes.Buffer) error {
	enc := json.NewEncoder(dst)
	for _, element := range data {
		if err := enc.Encode(element); err != nil {
			if err != io.EOF {
				return fmt.Errorf("failed to parse NDJSON: %v", err)
			}
			break
		}
	}
	return nil
}

func (edb *ElasticDB) SetElasticData(el []domain.ElasticLog) error {
	var body bytes.Buffer
	if err := ParseToNDJson(el, &body); err != nil {
		return fmt.Errorf("error encoding request: %s", err)
	}
	_, err := esapi.BulkRequest{
		Index: "logs",
		Body:  strings.NewReader(body.String()),
	}.Do(context.Background(), edb.Client.Transport)
	if err != nil {
		return err
	}

	return nil
}
```