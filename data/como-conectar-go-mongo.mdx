---
title: "쮺칩mo conectar Go a Mongo? 游꼒"
date: "19 de Julio del 2022"
published: "2022-07-19"
abstract: "Para este blog construiremos una soluci칩n en Go que nos permita obtener desde otra API."
image: "https://firebasestorage.googleapis.com/v0/b/portfolio-18ce8.appspot.com/o/images%2Fweb-technologies-4k-wallpaper.png?alt=media&token=e4d79b53-3452-49cd-b39e-402bf672aed9"
tag: "golang, Go "
author: "Carlos Garc칤a"
---

# 쮺칩mo conectar Go a Mongo? 游꼒

<small>19 de Julio del 2022</small>
<EditPost path="como-conectar-go-mongo" />

<img
  width="100%"
  alt="golang-wallpaper "
  src="https://wallpaperaccess.com/full/4482765.jpg"
/>

Una de las bases de datos m치s populares en la actualidad es Mongo sin embargo es m치s conocida en el mundo de JavaScript en Go las bases de datos que suelen utilizarse son PostgreSQL y MySQL, en este art칤culo aprenderemos como conectarnos a una base de datos de Mongo desde Go.

## Estructura de archivos

Para este tutorial organizaremos nuestras fuentes de datos en la carpeta repositorios. Los dem치s archivos estar치n ubicados en su posici칩n normal.

<FolderStructure
  tree={[
  {
    type: "folder",
    name: "config",
    content: [
      {
        type: "file",
        name: "config.go"
      }
    ]
  },
  {
    type: "folder",
    name: "repositories",
    content: [
      {
        type: "file",
        name: "mongo.go"
      }
    ]
  },
  {
    type: "file",
    name: "config.json"
  },
  {
    type: "file",
    name: ".gitignore"
  },
  {
    type: "file",
    name: "go.mod"
  },
  {
    type: "file",
    name: "main.go"
  }
]}
/>

Dentro de la carpeta repositorio estar칤a tambi칠n la conexi칩n con Redis si la tuvi칠semos o a una base de datos relacional como MySQL.

En un siguiente art칤culo entraremos m치s a detalle haciendo un CRUD con Go, Fiber y Mongo.

> 游눠Tip: Al empezar un proyecto nuevo en Go 
> ```go
> go mod init github.com/tuUsuario/elNombreDeTuCarpeta
> ```

## Creando nuestro archivo de configuraci칩n

Con Mongo tenemos la opci칩n de conectarnos usando un URL, dentro de este vienen distintos par치metros como usuario, contrase침a, servidor, etc.

Podemos abordar el archivo de configuraci칩n usando los distintos par치metros por separado o usando solo la URL de conexi칩n.

Para este art칤culo usaremos solo la URL para simplificar lo m치s que podamos y concentrarnos en realizar la conexi칩n.

```json
{
  "mongo_conn": "https://游뱖.com"
}
```

## Obteniendo la configuraci칩n desde el archivo config.json hacia Go

Para este ejemplo usaremos nuestro servicio de configuraci칩n explicado en <BlogLink url="/blog/como-obtener-variables-entorno-go-env-json/" content="el art칤culo"/> donde aprendemos a traer variables de configuraci칩n desde archivos JSON.

```go
  package config

  import (
    "encoding/json"
    "os"
  )

  type Config struct {
    MongoConn string `json:"mongo_conn"`
  }

  type ConfigService struct {
    Config     Config
    FilePath   string
  }

  func (s *Service) GetMongoConn() string {
    return s.Config.MongoConn
  }

  func (s *ConfigService) LoadConfigJSON() error {
    configuration := Config{}
    configFile, err := os.Open("./config.json")
    if err != nil {
      return err
    }

    jsonParser := json.NewDecoder(configFile)
    if err = jsonParser.Decode(&configuration);
    err != nil {
      return err
    }
    s.Config = configuration
    return nil
  }

  func NewConfigService(path string ) *Service {
    return &Service{
        FilePath:path,
    }
  }
```

## Implementando nuestra conexi칩n a Mongo

Primero instalemos el Mongo Driver que es el paquete oficial de Mongo.

```bash
go get go.mongodb.org/mongo-driver/mongo
```

Una buena forma de empezar la conexi칩n a Mongo es al momento de crear la instancia de este repositorio Mongo en el c칩digo podr치s ver como en la funci칩n creadora se inicializa la conexi칩n hacia Mongo.

```go
  package repositories

  import (
    "context"
    "time"

    "go.mongodb.org/mongo-driver/mongo"
    "go.mongodb.org/mongo-driver/mongo/options"
    "go.mongodb.org/mongo-driver/mongo/readpref"
  )

  type MongoHandler struct {
    Client *mongo.Client
    Config *config.ConfigService
  }

  func NewMongoHandler(config config.ConfigService) *MongoHandler{
    ctx, cancel := context.WithTimeout(context.Background(), 10*time.Second)
    defer cancel()
    client, err := mongo.Connect(ctx, options.Client().ApplyURI(config.GetMongoConn()))

    return &MongoHandler{
      Client: client,
      Config: config,
  }

  func (m *MongoHandler) CheckConnection() {
    err := client.Ping(ctx, readpref.Primary())
    if err != nil {
      panic(err)
    }
  }

  func (m *MongoHandler) Disconnect() {
    err := client.Disconnect(ctx);
    if err != nil {
      panic(err)
    }
  }
```

## Usando nuestra implementaci칩n

Ahora podremos usar nuestra base de datos en otros servicios por ahora comprobaremos la conexi칩n en main.go

```go
  package main

  import (
    "github.com/solrac97gr/go-mongo-conn/config"
    "github.com/solrac97gr/go-mongo-conn/repositories"
  )

  func main() {
    configService := config.NewConfigService("./config.json")
    mongoHandler := repositories.NewMongoHandler(configService)
    defer mongoHandler.Disconnect()

    mongoHandler.CheckConnection()
  }
```

## Detalles adicionales

Podemos crear distintos bases de datos de esta forma creando una interfaz que indique que cada base de datos debe tener los m칠todos Disconnect y CheckConnection y usar todos los m칠todos que necesitamos para que as칤 nuestros servicios puedan cambiar de base de datos de manera modular.
