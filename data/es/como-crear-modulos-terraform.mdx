---
title: "C√≥mo Crear M√≥dulos Profesionales de Terraform üèóÔ∏è"
date: "January 29, 2026"
published: "2026-01-29"
abstract: "Aprende a crear m√≥dulos de Terraform listos para producci√≥n con las mejores pr√°cticas, usando como ejemplo un m√≥dulo real de Azure OpenAI."
image: "https://firebasestorage.googleapis.com/v0/b/portfolio-18ce8.appspot.com/o/images%2Fterraform-module.png?alt=media&token=terraform-module-2026"
tag: "Terraform"
author: "Carlos Garc√≠a"
---

# C√≥mo Crear M√≥dulos Profesionales de Terraform üèóÔ∏è

<small>January 29, 2026</small>
<EditPost path="como-crear-modulos-terraform" />

<img
  width="100%"
  alt="terraform-modules"
  src="https://firebasestorage.googleapis.com/v0/b/portfolio-18ce8.appspot.com/o/images%2Fterraform-module.png?alt=media&token=terraform-module-2026"
  style={{ borderRadius: "8px" }}
/>

La Infraestructura como C√≥digo (IaC) se ha vuelto esencial en el desarrollo de software moderno, y Terraform es una de las herramientas m√°s poderosas para gestionar infraestructura en la nube. Una de las mayores fortalezas de Terraform es su sistema de m√≥dulos, que te permite crear componentes de infraestructura reutilizables y mantenibles.

En esta gu√≠a, te mostrar√© c√≥mo crear m√≥dulos de Terraform listos para producci√≥n usando mi <BlogLink url="https://github.com/solrac97gr/terraform-azurerm-gpt" content="m√≥dulo terraform-azurerm-gpt"/> como ejemplo del mundo real.

## ¬øQu√© es un M√≥dulo de Terraform?

Un m√≥dulo de Terraform es un contenedor para m√∫ltiples recursos que se utilizan juntos. Pi√©nsalo como un bloque de construcci√≥n que encapsula l√≥gica de infraestructura, haci√©ndola reutilizable en diferentes proyectos y equipos.

**Beneficios de usar m√≥dulos:**
- **Reutilizaci√≥n**: Escribe una vez, √∫salo en todas partes
- **Mantenibilidad**: Actualiza en un lugar, aplica en todos lados
- **Estandarizaci√≥n**: Asegura patrones de infraestructura consistentes
- **Abstracci√≥n**: Oculta la complejidad detr√°s de interfaces simples

## Estructura del M√≥dulo

Un m√≥dulo de Terraform bien organizado sigue una estructura est√°ndar. Aqu√≠ est√° la anatom√≠a b√°sica:

<CodeSnippet language="bash" code={`terraform-azurerm-gpt/
‚îú‚îÄ‚îÄ main.tf           # Definiciones de recursos principales
‚îú‚îÄ‚îÄ variables.tf      # Declaraciones de variables de entrada
‚îú‚îÄ‚îÄ outputs.tf        # Definiciones de salidas
‚îú‚îÄ‚îÄ versions.tf       # Restricciones de versi√≥n del proveedor
‚îú‚îÄ‚îÄ README.md         # Documentaci√≥n del m√≥dulo
‚îú‚îÄ‚îÄ CHANGELOG.md      # Historial de versiones
‚îî‚îÄ‚îÄ examples/         # Ejemplos de uso
    ‚îú‚îÄ‚îÄ basic/
    ‚îú‚îÄ‚îÄ complete/
    ‚îî‚îÄ‚îÄ private-endpoint/`} />

Exploremos cada componente en detalle.

## 1. versions.tf - Gesti√≥n de Dependencias

Comienza definiendo los requisitos de versi√≥n de Terraform y del proveedor. Esto previene incompatibilidades de versiones y asegura compatibilidad.

<CodeSnippet language="hcl" route="versions.tf" code={`terraform {
  required_version = ">= 1.5.0"

  required_providers {
    azurerm = {
      source  = "hashicorp/azurerm"
      version = ">= 3.80.0"
    }
  }
}`} />

**Mejor Pr√°ctica**: Siempre especifica versiones m√≠nimas para asegurar que tu m√≥dulo use caracter√≠sticas y correcciones de bugs de versiones espec√≠ficas del proveedor.

## 2. variables.tf - Configuraci√≥n de Entrada

Las variables son la interfaz de tu m√≥dulo. Dise√±alas cuidadosamente para balancear simplicidad y flexibilidad.

### Variables B√°sicas Requeridas

<CodeSnippet language="hcl" route="variables.tf" code={`variable "name" {
  description = "El nombre de la cuenta de Cognitive Services"
  type        = string
}

variable "location" {
  description = "La regi√≥n de Azure donde se crear√°n los recursos"
  type        = string
}

variable "resource_group_name" {
  description = "El nombre del grupo de recursos"
  type        = string
}`} />

### Variables con Valores por Defecto

<CodeSnippet language="hcl" route="variables.tf" code={`variable "sku_name" {
  description = "El nombre del SKU de la cuenta de Cognitive Services"
  type        = string
  default     = "S0"
}

variable "identity_type" {
  description = "El tipo de identidad administrada (SystemAssigned, UserAssigned, o SystemAssigned, UserAssigned)"
  type        = string
  default     = "SystemAssigned"

  validation {
    condition     = can(regex("^(SystemAssigned|UserAssigned|SystemAssigned, UserAssigned)$", var.identity_type))
    error_message = "El tipo de identidad debe ser SystemAssigned, UserAssigned, o SystemAssigned, UserAssigned."
  }
}`} />

**Caracter√≠stica Clave**: La validaci√≥n de entrada asegura que los usuarios proporcionen valores correctos antes de aplicar cambios.

### Variables de Objetos Complejos

Para configuraciones avanzadas, usa tipos de objetos complejos:

<CodeSnippet language="hcl" route="variables.tf" code={`variable "deployments" {
  description = "Lista de despliegues de modelos a crear"
  type = list(object({
    name            = string
    model_format    = string
    model_name      = string
    model_version   = string
    scale_type      = string
    scale_capacity  = optional(number, 1)
    rai_policy_name = optional(string, null)
  }))
  default = []
}

variable "network_acls" {
  description = "Configuraci√≥n de ACLs de red para la cuenta de Cognitive Services"
  type = object({
    default_action = string
    ip_rules       = optional(list(string), [])
    subnet_id      = optional(string, null)
  })
  default = null
}`} />

**Patr√≥n Avanzado**: Usar `optional()` permite que los campos tengan valores por defecto, haciendo tu m√≥dulo compatible hacia atr√°s mientras agregas caracter√≠sticas.

## 3. main.tf - Definiciones de Recursos

Aqu√≠ es donde defines los recursos de infraestructura reales.

### Recurso Principal

<CodeSnippet language="hcl" route="main.tf" code={`resource "azurerm_cognitive_account" "openai" {
  name                  = var.name
  location              = var.location
  resource_group_name   = var.resource_group_name
  kind                  = "OpenAI"
  sku_name              = var.sku_name
  custom_subdomain_name = var.custom_subdomain != null ? var.custom_subdomain : var.name

  identity {
    type         = var.identity_type
    identity_ids = var.identity_type != "SystemAssigned" ? var.identity_ids : null
  }

  tags = var.tags
}`} />

### Patr√≥n de Bloques Din√°micos

Usa bloques din√°micos para crear condicionalmente bloques de configuraci√≥n anidados:

<CodeSnippet language="hcl" route="main.tf" code={`resource "azurerm_cognitive_account" "openai" {
  # ... otra configuraci√≥n ...

  dynamic "network_acls" {
    for_each = var.network_acls != null ? [var.network_acls] : []

    content {
      default_action = network_acls.value.default_action
      ip_rules       = network_acls.value.ip_rules

      dynamic "virtual_network_rules" {
        for_each = network_acls.value.subnet_id != null ? [network_acls.value.subnet_id] : []

        content {
          subnet_id                            = virtual_network_rules.value
          ignore_missing_vnet_service_endpoint = true
        }
      }
    }
  }
}`} />

**Escenario del Mundo Real**: Este patr√≥n permite a los usuarios configurar opcionalmente la seguridad de red sin requerir valores vac√≠os.

### Patr√≥n For-Each para M√∫ltiples Recursos

Crea m√∫ltiples recursos similares desde una lista:

<CodeSnippet language="hcl" route="main.tf" code={`resource "azurerm_cognitive_deployment" "deployment" {
  for_each = { for deployment in var.deployments : deployment.name => deployment }

  name                 = each.value.name
  cognitive_account_id = azurerm_cognitive_account.openai.id

  model {
    format  = each.value.model_format
    name    = each.value.model_name
    version = each.value.model_version
  }

  scale {
    type     = each.value.scale_type
    capacity = each.value.scale_capacity
  }

  rai_policy_name = each.value.rai_policy_name
}`} />

**Por Qu√© Funciona Este Patr√≥n**:
- Cada despliegue obtiene una clave √∫nica (el nombre del modelo)
- Los recursos pueden ser apuntados individualmente: `terraform apply -target=module.openai.azurerm_cognitive_deployment.deployment["gpt-4"]`
- Agregar o remover modelos no afecta otros despliegues

### Creaci√≥n Condicional de Recursos

Usa `count` para recursos que pueden o no ser necesarios:

<CodeSnippet language="hcl" route="main.tf" code={`resource "azurerm_private_endpoint" "openai" {
  count = var.private_endpoint_enabled ? 1 : 0

  name                = "\${var.name}-private-endpoint"
  location            = var.location
  resource_group_name = var.resource_group_name
  subnet_id           = var.private_endpoint_subnet_id

  private_service_connection {
    name                           = "\${var.name}-privateserviceconnection"
    private_connection_resource_id = azurerm_cognitive_account.openai.id
    subresource_names              = ["account"]
    is_manual_connection           = false
  }

  private_dns_zone_group {
    name                 = "default"
    private_dns_zone_ids = var.private_dns_zone_ids
  }
}`} />

### Asignaciones de Roles RBAC

Automatiza las asignaciones de roles usando `for_each` con conjuntos:

<CodeSnippet language="hcl" route="main.tf" code={`resource "azurerm_role_assignment" "openai_user" {
  for_each = toset(var.cognitive_services_openai_user_principals)

  scope                = azurerm_cognitive_account.openai.id
  role_definition_name = "Cognitive Services OpenAI User"
  principal_id         = each.value
}

resource "azurerm_role_assignment" "openai_contributor" {
  for_each = toset(var.cognitive_services_openai_contributor_principals)

  scope                = azurerm_cognitive_account.openai.id
  role_definition_name = "Cognitive Services OpenAI Contributor"
  principal_id         = each.value
}`} />

**Mejor Pr√°ctica de Seguridad**: Usar `toset()` deduplica los IDs principales y previene asignaciones de roles duplicadas.

## 4. outputs.tf - Exponiendo Recursos

Las salidas permiten a los usuarios referenciar recursos creados y recuperar informaci√≥n importante:

<CodeSnippet language="hcl" route="outputs.tf" code={`output "id" {
  description = "El ID de la cuenta de Cognitive Services"
  value       = azurerm_cognitive_account.openai.id
}

output "endpoint" {
  description = "El endpoint usado para conectarse a la cuenta de Cognitive Services"
  value       = azurerm_cognitive_account.openai.endpoint
}

output "primary_access_key" {
  description = "La clave de acceso primaria para la cuenta de Cognitive Services"
  value       = azurerm_cognitive_account.openai.primary_access_key
  sensitive   = true
}

output "identity_principal_id" {
  description = "El ID principal de la identidad administrada asignada por el sistema"
  value       = var.identity_type == "SystemAssigned" || var.identity_type == "SystemAssigned, UserAssigned" ? azurerm_cognitive_account.openai.identity[0].principal_id : null
}`} />

**Patr√≥n de Seguridad Cr√≠tico**: Marca las salidas sensibles con `sensitive = true` para prevenir exposici√≥n accidental en logs y salida de consola.

## 5. Ejemplos de Uso

Proporciona ejemplos mostrando c√≥mo usar tu m√≥dulo. Comienza simple y muestra progresivamente escenarios m√°s complejos.

### Ejemplo B√°sico

<CodeSnippet language="hcl" route="examples/basic/main.tf" code={`provider "azurerm" {
  features {}
}

resource "azurerm_resource_group" "example" {
  name     = "rg-openai-example"
  location = "East US"
}

module "openai" {
  source = "github.com/solrac97gr/terraform-azurerm-gpt"

  name                = "openai-example"
  location            = azurerm_resource_group.example.location
  resource_group_name = azurerm_resource_group.example.name

  deployments = [
    {
      name           = "gpt-4o-mini"
      model_format   = "OpenAI"
      model_name     = "gpt-4o-mini"
      model_version  = "2024-07-18"
      scale_type     = "GlobalStandard"
      scale_capacity = 1
    }
  ]
}`} />

### Ejemplo Completo con Networking

<CodeSnippet language="hcl" route="examples/complete/main.tf" code={`module "openai" {
  source = "github.com/solrac97gr/terraform-azurerm-gpt"

  name                = "openai-complete"
  location            = azurerm_resource_group.example.location
  resource_group_name = azurerm_resource_group.example.name

  # Configuraci√≥n de identidad
  identity_type = "SystemAssigned, UserAssigned"
  identity_ids  = [azurerm_user_assigned_identity.example.id]

  # M√∫ltiples despliegues de modelos
  deployments = [
    {
      name           = "gpt-4"
      model_format   = "OpenAI"
      model_name     = "gpt-4"
      model_version  = "0613"
      scale_type     = "Standard"
      scale_capacity = 10
    },
    {
      name           = "gpt-35-turbo"
      model_format   = "OpenAI"
      model_name     = "gpt-35-turbo"
      model_version  = "0613"
      scale_type     = "Standard"
      scale_capacity = 10
    }
  ]

  # Seguridad de red
  network_acls = {
    default_action = "Deny"
    ip_rules       = ["203.0.113.0/24"]
    subnet_id      = azurerm_subnet.example.id
  }

  # Asignaciones RBAC
  cognitive_services_openai_user_principals = [
    data.azurerm_client_config.current.object_id
  ]

  tags = {
    Environment = "Production"
    ManagedBy   = "Terraform"
  }
}`} />

## Resumen de Mejores Pr√°cticas

1. **Restricciones de Versi√≥n**: Siempre especifica versiones m√≠nimas del proveedor
2. **Validaci√≥n de Entrada**: Valida variables para detectar errores temprano
3. **Par√°metros Opcionales**: Usa `optional()` para compatibilidad hacia atr√°s
4. **Datos Sensibles**: Marca salidas que contengan secretos como `sensitive = true`
5. **Documentaci√≥n**: Proporciona descripciones claras para todas las variables y salidas
6. **Ejemplos**: Incluye ejemplos b√°sicos, completos y de casos extremos
7. **Bloques Din√°micos**: Usa para configuraci√≥n anidada condicional
8. **For-Each vs Count**: Usa `for_each` para recursos nombrados, `count` para creaci√≥n condicional
9. **Seguridad de Tipos**: Usa tipos de objetos espec√≠ficos en lugar de `any`
10. **Gesti√≥n de Estado**: Dise√±a para operaciones idempotentes

## Publicando Tu M√≥dulo

Una vez que tu m√≥dulo est√© listo, puedes publicarlo en:

### Terraform Registry (P√∫blico)

<CodeSnippet language="bash" code={`# 1. Crea un repositorio de GitHub llamado: terraform-<PROVEEDOR>-<NOMBRE>
# Ejemplo: terraform-azurerm-gpt

# 2. Etiqueta un release
git tag v1.0.0
git push origin v1.0.0

# 3. Inicia sesi√≥n en registry.terraform.io y publica`} />

### Registro de M√≥dulos Privado

<CodeSnippet language="hcl" code={`# Referencia desde Git
module "openai" {
  source = "git::https://github.com/your-org/terraform-azurerm-gpt.git?ref=v1.0.0"
  # ...
}

# O usa el registro privado de Terraform Cloud/Enterprise
module "openai" {
  source  = "app.terraform.io/your-org/gpt/azurerm"
  version = "1.0.0"
  # ...
}`} />

## Probando Tu M√≥dulo

Crea pruebas automatizadas para asegurar que tu m√≥dulo funcione correctamente:

<CodeSnippet language="bash" code={`# Inicializa el ejemplo
cd examples/basic
terraform init

# Valida sintaxis
terraform validate

# Verifica formato
terraform fmt -check -recursive

# Planifica sin aplicar
terraform plan

# Aplica y prueba
terraform apply -auto-approve
terraform output

# Limpia
terraform destroy -auto-approve`} />

## Conclusi√≥n

Crear m√≥dulos profesionales de Terraform requiere dise√±o cuidadoso y atenci√≥n a las mejores pr√°cticas. Siguiendo los patrones demostrados en esta gu√≠a, puedes construir componentes de infraestructura reutilizables que:

- Simplifiquen despliegues complejos
- Aseguren consistencia entre entornos
- Reduzcan duplicaci√≥n y carga de mantenimiento
- Permitan a los equipos moverse m√°s r√°pido con confianza

La clave es comenzar simple e iterar. Empieza con un m√≥dulo b√°sico, recopila retroalimentaci√≥n, y evoluci√≥nalo bas√°ndote en uso del mundo real.

Revisa el <BlogLink url="https://github.com/solrac97gr/terraform-azurerm-gpt" content="m√≥dulo completo terraform-azurerm-gpt en GitHub"/> para ver todos estos patrones en acci√≥n, y si√©ntete libre de usarlo como plantilla para tus propios m√≥dulos.

---

¬°Gracias por leer! Si encontraste esto √∫til, comp√°rtelo con tu equipo y s√≠gueme para m√°s contenido sobre infraestructura como c√≥digo e ingenier√≠a en la nube.
